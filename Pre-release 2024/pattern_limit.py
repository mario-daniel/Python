class Puzzle():
    def __init__(self, *args):
        if len(args) == 1:
            self.__Score = 0
            self.__SymbolsLeft = 0
            self.__GridSize = 0
            self.__Grid = []
            self.__AllowedPatterns = []
            self.__AllowedSymbols = []
            self.__LoadPuzzle(args[0])
        else:
            self.__Score = 0
            self.__SymbolsLeft = args[1]
            self.__GridSize = args[0]
            self.__Grid = []
            for Count in range(1, self.__GridSize * self.__GridSize + 1):
                if random.randrange(1, 101) < 90:
                    C = Cell()
                else:
                    C = BlockedCell()
                self.__Grid.append(C)
            self.__AllowedPatterns = []
            self.__AllowedSymbols = []
#-------------------------------------------------------------------------------
            QPattern = Pattern("Q", "QQ**Q**QQ", random.randint(1, 3))
#-------------------------------------------------------------------------------
            self.__AllowedPatterns.append(QPattern)
            self.__AllowedSymbols.append("Q")
#-------------------------------------------------------------------------------
            XPattern = Pattern("X", "X*X*X*X*X", random.randint(1, 3))
#-------------------------------------------------------------------------------
            self.__AllowedPatterns.append(XPattern)
            self.__AllowedSymbols.append("X")
#-------------------------------------------------------------------------------
            TPattern = Pattern("T", "TTT**T**T", random.randint(1, 3))
#-------------------------------------------------------------------------------
            self.__AllowedPatterns.append(TPattern)
            self.__AllowedSymbols.append("T")

    def AttemptPuzzle(self):
        Finished = False
        while not Finished:
            self.DisplayPuzzle()
            print("Current score: " + str(self.__Score))
#-------------------------------------------------------------------------------
            for P in self.__AllowedPatterns:
                P.OutputPatternCount()
#-------------------------------------------------------------------------------
            Row = -1
            Valid = False
            while not Valid:
                try:
                    Row = int(input("Enter row number: "))
                    Valid = True
                except:
                    pass
            Column = -1
            Valid = False
            while not Valid:
                try:
                    Column = int(input("Enter column number: "))
                    Valid = True
                except:
                    pass
            Symbol = self.__GetSymbolFromUser()
            self.__SymbolsLeft -= 1
            CurrentCell = self.__GetCell(Row, Column)
            if CurrentCell.CheckSymbolAllowed(Symbol):
                CurrentCell.ChangeSymbolInCell(Symbol)
                AmountToAddToScore = self.CheckforMatchWithPattern(Row, Column)
                if AmountToAddToScore > 0:
                    self.__Score += AmountToAddToScore
            if self.__SymbolsLeft == 0:
                Finished = True
        print()
        self.DisplayPuzzle()
        print()
        return self.__Score

    def CheckforMatchWithPattern(self, Row, Column):
        for StartRow in range(Row + 2, Row - 1, -1):
            for StartColumn in range(Column - 2, Column + 1):
                try:
                    PatternString = ""
                    PatternString += self.__GetCell(StartRow, StartColumn).GetSymbol()
                    PatternString += self.__GetCell(StartRow, StartColumn + 1).GetSymbol()
                    PatternString += self.__GetCell(StartRow, StartColumn + 2).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 1, StartColumn + 2).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 2, StartColumn + 2).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 2, StartColumn + 1).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 2, StartColumn).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 1, StartColumn).GetSymbol()
                    PatternString += self.__GetCell(StartRow - 1, StartColumn + 1).GetSymbol()
                    for P in self.__AllowedPatterns:
                        CurrentSymbol = self.__GetCell(Row, Column).GetSymbol()
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
                        if P.MatchesPattern(PatternString, CurrentSymbol) and P.UpdatePatternCount():
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
                            self.__GetCell(StartRow, StartColumn).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow, StartColumn + 1).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow, StartColumn + 2).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 1, StartColumn + 2).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 2, StartColumn + 2).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 2, StartColumn + 1).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 2, StartColumn).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 1, StartColumn).AddToNotAllowedSymbols(CurrentSymbol)
                            self.__GetCell(StartRow - 1, StartColumn + 1).AddToNotAllowedSymbols(CurrentSymbol)
                            return 10
                except:
                    pass
        return 0

class Pattern():
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
    def __init__(self, SymbolToUse, PatternString, PatternCount):
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
        self.__Symbol = SymbolToUse
        self.__PatternSequence = PatternString
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
        self.__PatternCount = PatternCount
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
#--------------------------------------------------------------------------------------------------------------------------------------------------------------   
    def UpdatePatternCount(self):
        if self.__PatternCount == 0:
            print(f'No more {self.__Symbol} Patterns available to use')
            return False
        else:
            self.__PatternCount -= 1
            return True

    def OutputPatternCount(self):
        print(f'{self.__Symbol}: {self.__PatternCount}')
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
